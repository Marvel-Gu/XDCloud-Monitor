import{at as j,ba as Le,bb as se,bc as Ce,g as be,Z as ue,bd as we,F as me,h as oe,be as ve,bf as Te,bg as xe,a7 as ye,u as he,b5 as ze,t as z,bh as Se,C as Oe,j as _,G as ce,a5 as ke,K as Ie,o as T,d as de,b as w,w as S,a as C,n as h,k as a,M as fe,ac as Ne,l as O,E as V,O as $e,c as M,ad as re,bi as Re,bj as Ae,bk as Be,bl as Me,e as Ve,bm as Fe,bn as Pe,am as Xe,ay as Ye,az as De,m as ae,T as We,b6 as He,q as _e,a2 as K,$ as H,bo as je,s as Ee,bp as Ke,bq as Ze,aa as qe,au as Ge,af as Ue,P as Je}from"./index-b0e8aca7.js";import{u as Qe}from"./base-3c5e1f2d.js";import{g as et}from"./scroll-8a73c3bc.js";const tt=(e,o)=>{if(!j||!e||!o)return!1;const r=e.getBoundingClientRect();let s;return o instanceof Element?s=o.getBoundingClientRect():s={top:0,right:window.innerWidth,bottom:window.innerHeight,left:0},r.top<s.bottom&&r.bottom>s.top&&r.right>s.left&&r.left<s.right};var nt=/\s/;function at(e){for(var o=e.length;o--&&nt.test(e.charAt(o)););return o}var st=/^\s+/;function rt(e){return e&&e.slice(0,at(e)+1).replace(st,"")}var pe=0/0,ot=/^[-+]0x[0-9a-f]+$/i,it=/^0b[01]+$/i,lt=/^0o[0-7]+$/i,ut=parseInt;function ge(e){if(typeof e=="number")return e;if(Le(e))return pe;if(se(e)){var o=typeof e.valueOf=="function"?e.valueOf():e;e=se(o)?o+"":o}if(typeof e!="string")return e===0?e:+e;e=rt(e);var r=it.test(e);return r||lt.test(e)?ut(e.slice(2),r?2:8):ot.test(e)?pe:+e}var ct=function(){return Ce.Date.now()};const ie=ct;var dt="Expected a function",ft=Math.max,mt=Math.min;function vt(e,o,r){var s,f,k,l,p,y,I=0,E=!1,g=!1,m=!0;if(typeof e!="function")throw new TypeError(dt);o=ge(o)||0,se(r)&&(E=!!r.leading,g="maxWait"in r,k=g?ft(ge(r.maxWait)||0,o):k,m="trailing"in r?!!r.trailing:m);function v(u){var b=s,R=f;return s=f=void 0,I=u,l=e.apply(R,b),l}function d(u){return I=u,p=setTimeout($,o),E?v(u):l}function F(u){var b=u-y,R=u-I,D=o-b;return g?mt(D,k-R):D}function N(u){var b=u-y,R=u-I;return y===void 0||b>=o||b<0||g&&R>=k}function $(){var u=ie();if(N(u))return Y(u);p=setTimeout($,F(u))}function Y(u){return p=void 0,m&&s?v(u):(s=f=void 0,l)}function Z(){p!==void 0&&clearTimeout(p),I=0,s=y=f=p=void 0}function P(){return p===void 0?l:Y(ie())}function X(){var u=ie(),b=N(u);if(s=arguments,f=this,y=u,b){if(p===void 0)return d(y);if(g)return clearTimeout(p),p=setTimeout($,o),v(y)}return p===void 0&&(p=setTimeout($,o)),l}return X.cancel=Z,X.flush=P,X}var pt="Expected a function";function le(e,o,r){var s=!0,f=!0;if(typeof e!="function")throw new TypeError(pt);return se(r)&&(s="leading"in r?!!r.leading:s,f="trailing"in r?!!r.trailing:f),vt(e,o,{leading:s,maxWait:o,trailing:f})}const gt=be({urlList:{type:ue(Array),default:()=>we([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2}}),bt={close:()=>!0,switch:e=>me(e)},wt=["src"],yt=oe({name:"ElImageViewer"}),ht=oe({...yt,props:gt,emits:bt,setup(e,{expose:o,emit:r}){const s=e,f={CONTAIN:{name:"contain",icon:ve(Te)},ORIGINAL:{name:"original",icon:ve(xe)}},{t:k}=ye(),l=he("image-viewer"),{nextZIndex:p}=ze(),y=z(),I=z([]),E=Se(),g=z(!0),m=z(s.initialIndex),v=Oe(f.CONTAIN),d=z({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),F=_(()=>{const{urlList:t}=s;return t.length<=1}),N=_(()=>m.value===0),$=_(()=>m.value===s.urlList.length-1),Y=_(()=>s.urlList[m.value]),Z=_(()=>[l.e("btn"),l.e("prev"),l.is("disabled",!s.infinite&&N.value)]),P=_(()=>[l.e("btn"),l.e("next"),l.is("disabled",!s.infinite&&$.value)]),X=_(()=>{const{scale:t,deg:i,offsetX:c,offsetY:L,enableTransition:A}=d.value;let x=c/t,B=L/t;switch(i%360){case 90:case-270:[x,B]=[B,-x];break;case 180:case-180:[x,B]=[-x,-B];break;case 270:case-90:[x,B]=[-B,x];break}const W={transform:`scale(${t}) rotate(${i}deg) translate(${x}px, ${B}px)`,transition:A?"transform .3s":""};return v.value.name===f.CONTAIN.name&&(W.maxWidth=W.maxHeight="100%"),W}),u=_(()=>me(s.zIndex)?s.zIndex:p());function b(){D(),r("close")}function R(){const t=le(c=>{switch(c.code){case H.esc:s.closeOnPressEscape&&b();break;case H.space:ee();break;case H.left:te();break;case H.up:n("zoomIn");break;case H.right:ne();break;case H.down:n("zoomOut");break}}),i=le(c=>{const L=c.deltaY||c.deltaX;n(L<0?"zoomIn":"zoomOut",{zoomRate:s.zoomRate,enableTransition:!1})});E.run(()=>{K(document,"keydown",t),K(document,"wheel",i)})}function D(){E.stop()}function U(){g.value=!1}function J(t){g.value=!1,t.target.alt=k("el.image.error")}function Q(t){if(g.value||t.button!==0||!y.value)return;d.value.enableTransition=!1;const{offsetX:i,offsetY:c}=d.value,L=t.pageX,A=t.pageY,x=le(W=>{d.value={...d.value,offsetX:i+W.pageX-L,offsetY:c+W.pageY-A}}),B=K(document,"mousemove",x);K(document,"mouseup",()=>{B()}),t.preventDefault()}function q(){d.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function ee(){if(g.value)return;const t=je(f),i=Object.values(f),c=v.value.name,A=(i.findIndex(x=>x.name===c)+1)%t.length;v.value=f[t[A]],q()}function G(t){const i=s.urlList.length;m.value=(t+i)%i}function te(){N.value&&!s.infinite||G(m.value-1)}function ne(){$.value&&!s.infinite||G(m.value+1)}function n(t,i={}){if(g.value)return;const{zoomRate:c,rotateDeg:L,enableTransition:A}={zoomRate:s.zoomRate,rotateDeg:90,enableTransition:!0,...i};switch(t){case"zoomOut":d.value.scale>.2&&(d.value.scale=Number.parseFloat((d.value.scale/c).toFixed(3)));break;case"zoomIn":d.value.scale<7&&(d.value.scale=Number.parseFloat((d.value.scale*c).toFixed(3)));break;case"clockwise":d.value.deg+=L;break;case"anticlockwise":d.value.deg-=L;break}d.value.enableTransition=A}return ce(Y,()=>{ke(()=>{const t=I.value[0];t!=null&&t.complete||(g.value=!0)})}),ce(m,t=>{q(),r("switch",t)}),Ie(()=>{var t,i;R(),(i=(t=y.value)==null?void 0:t.focus)==null||i.call(t)}),o({setActiveItem:G}),(t,i)=>(T(),de(He,{to:"body",disabled:!t.teleported},[w(We,{name:"viewer-fade",appear:""},{default:S(()=>[C("div",{ref_key:"wrapper",ref:y,tabindex:-1,class:h(a(l).e("wrapper")),style:fe({zIndex:a(u)})},[C("div",{class:h(a(l).e("mask")),onClick:i[0]||(i[0]=Ne(c=>t.hideOnClickModal&&b(),["self"]))},null,2),O(" CLOSE "),C("span",{class:h([a(l).e("btn"),a(l).e("close")]),onClick:b},[w(a(V),null,{default:S(()=>[w(a($e))]),_:1})],2),O(" ARROW "),a(F)?O("v-if",!0):(T(),M(re,{key:0},[C("span",{class:h(a(Z)),onClick:te},[w(a(V),null,{default:S(()=>[w(a(Re))]),_:1})],2),C("span",{class:h(a(P)),onClick:ne},[w(a(V),null,{default:S(()=>[w(a(Ae))]),_:1})],2)],64)),O(" ACTIONS "),C("div",{class:h([a(l).e("btn"),a(l).e("actions")])},[C("div",{class:h(a(l).e("actions__inner"))},[w(a(V),{onClick:i[1]||(i[1]=c=>n("zoomOut"))},{default:S(()=>[w(a(Be))]),_:1}),w(a(V),{onClick:i[2]||(i[2]=c=>n("zoomIn"))},{default:S(()=>[w(a(Me))]),_:1}),C("i",{class:h(a(l).e("actions__divider"))},null,2),w(a(V),{onClick:ee},{default:S(()=>[(T(),de(Ve(a(v).icon)))]),_:1}),C("i",{class:h(a(l).e("actions__divider"))},null,2),w(a(V),{onClick:i[3]||(i[3]=c=>n("anticlockwise"))},{default:S(()=>[w(a(Fe))]),_:1}),w(a(V),{onClick:i[4]||(i[4]=c=>n("clockwise"))},{default:S(()=>[w(a(Pe))]),_:1})],2)],2),O(" CANVAS "),C("div",{class:h(a(l).e("canvas"))},[(T(!0),M(re,null,Xe(t.urlList,(c,L)=>Ye((T(),M("img",{ref_for:!0,ref:A=>I.value[L]=A,key:c,src:c,style:fe(a(X)),class:h(a(l).e("img")),onLoad:U,onError:J,onMousedown:Q},null,46,wt)),[[De,L===m.value]])),128))],2),ae(t.$slots,"default")],6)]),_:3})],8,["disabled"]))}});var kt=_e(ht,[["__file","/home/runner/work/element-plus/element-plus/packages/components/image-viewer/src/image-viewer.vue"]]);const It=Ee(kt),_t=be({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:ue([String,Object])},previewSrcList:{type:ue(Array),default:()=>we([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2}}),Et={load:e=>e instanceof Event,error:e=>e instanceof Event,switch:e=>me(e),close:()=>!0,show:()=>!0},Lt=["src","loading"],Ct={key:0},Tt=oe({name:"ElImage",inheritAttrs:!1}),xt=oe({...Tt,props:_t,emits:Et,setup(e,{emit:o}){const r=e;let s="";const{t:f}=ye(),k=he("image"),l=Ke(),p=Qe(),y=z(),I=z(!1),E=z(!0),g=z(!1),m=z(),v=z(),d=j&&"loading"in HTMLImageElement.prototype;let F,N;const $=_(()=>[k.e("inner"),P.value&&k.e("preview"),E.value&&k.is("loading")]),Y=_(()=>l.style),Z=_(()=>{const{fit:n}=r;return j&&n?{objectFit:n}:{}}),P=_(()=>{const{previewSrcList:n}=r;return Array.isArray(n)&&n.length>0}),X=_(()=>{const{previewSrcList:n,initialIndex:t}=r;let i=t;return t>n.length-1&&(i=0),i}),u=_(()=>r.loading==="eager"?!1:!d&&r.loading==="lazy"||r.lazy),b=()=>{j&&(E.value=!0,I.value=!1,y.value=r.src)};function R(n){E.value=!1,I.value=!1,o("load",n)}function D(n){E.value=!1,I.value=!0,o("error",n)}function U(){tt(m.value,v.value)&&(b(),q())}const J=Ze(U,200,!0);async function Q(){var n;if(!j)return;await ke();const{scrollContainer:t}=r;Ge(t)?v.value=t:Ue(t)&&t!==""?v.value=(n=document.querySelector(t))!=null?n:void 0:m.value&&(v.value=et(m.value)),v.value&&(F=K(v,"scroll",J),setTimeout(()=>U(),100))}function q(){!j||!v.value||!J||(F==null||F(),v.value=void 0)}function ee(n){if(n.ctrlKey){if(n.deltaY<0)return n.preventDefault(),!1;if(n.deltaY>0)return n.preventDefault(),!1}}function G(){P.value&&(N=K("wheel",ee,{passive:!1}),s=document.body.style.overflow,document.body.style.overflow="hidden",g.value=!0,o("show"))}function te(){N==null||N(),document.body.style.overflow=s,g.value=!1,o("close")}function ne(n){o("switch",n)}return ce(()=>r.src,()=>{u.value?(E.value=!0,I.value=!1,q(),Q()):b()}),Ie(()=>{u.value?Q():b()}),(n,t)=>(T(),M("div",{ref_key:"container",ref:m,class:h([a(k).b(),n.$attrs.class]),style:fe(a(Y))},[I.value?ae(n.$slots,"error",{key:0},()=>[C("div",{class:h(a(k).e("error"))},Je(a(f)("el.image.error")),3)]):(T(),M(re,{key:1},[y.value!==void 0?(T(),M("img",qe({key:0},a(p),{src:y.value,loading:n.loading,style:a(Z),class:a($),onClick:G,onLoad:R,onError:D}),null,16,Lt)):O("v-if",!0),E.value?(T(),M("div",{key:1,class:h(a(k).e("wrapper"))},[ae(n.$slots,"placeholder",{},()=>[C("div",{class:h(a(k).e("placeholder"))},null,2)])],2)):O("v-if",!0)],64)),a(P)?(T(),M(re,{key:2},[g.value?(T(),de(a(It),{key:0,"z-index":n.zIndex,"initial-index":a(X),infinite:n.infinite,"zoom-rate":n.zoomRate,"url-list":n.previewSrcList,"hide-on-click-modal":n.hideOnClickModal,teleported:n.previewTeleported,"close-on-press-escape":n.closeOnPressEscape,onClose:te,onSwitch:ne},{default:S(()=>[n.$slots.viewer?(T(),M("div",Ct,[ae(n.$slots,"viewer")])):O("v-if",!0)]),_:3},8,["z-index","initial-index","infinite","zoom-rate","url-list","hide-on-click-modal","teleported","close-on-press-escape"])):O("v-if",!0)],64)):O("v-if",!0)],6))}});var zt=_e(xt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/image/src/image.vue"]]);const $t=Ee(zt);export{$t as E,vt as d};
