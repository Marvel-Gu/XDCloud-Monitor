import"./base-3c5e1f2d.js";import{o as Z,E as X,d as ue,e as pe}from"./index-505c32df.js";import{E as me}from"./el-avatar-c000b94c.js";import{E as _e,a as fe}from"./el-col-30f14d01.js";import{a as Y,b as ee,E as se}from"./el-input-e755fe7e.js";import{E as le}from"./el-button-a220bfc2.js";import{_ as te,v as P,t as g,o as f,c as y,a as s,b as e,w as a,k as i,y as ge,R as ve,z as R,ad as ae,am as oe,n as G,P as w,B as d,M as ye,V as b,W as D,p as ne,f as ie,aj as xe,U as N,d as H,br as he,bs as be,aU as we,aW as J,ar as K,A as Q}from"./index-b0e8aca7.js";import{E as Ve}from"./el-scrollbar-e588f6f8.js";import{E as Ee}from"./el-checkbox-78ede89b.js";import"./vnode-cd11beef.js";import"./scroll-8a73c3bc.js";const L=_=>(ne("data-v-aa2e36eb"),_=_(),ie(),_),$e={style:{padding:"15px 20px",height:"100%"}},ke={style:{display:"flex","flex-direction":"column",height:"100%"}},Ce=L(()=>s("div",{class:"title"},[s("i",{class:"fa-solid fa-user-plus"}),d(" 添加新的子账户 ")],-1)),Se=L(()=>s("div",{class:"desc"},"子账户同样用于管理服务器，但是可以自由分配指定的服务器，子账户只能访问被分配到的服务器。",-1)),ze=L(()=>s("div",{class:"desc"},"请在下方选择允许子账户访问的服务器列表。",-1)),Ae={class:"client-card"},Ue={style:{"margin-left":"20px"}},Ie={style:{"font-size":"14px","font-weight":"bold"}},qe={style:{margin:"0 10px"}},Ne={style:{"font-size":"12px",color:"grey"}},Re={style:{"font-size":"12px",color:"grey"}},Be={style:{"margin-right":"10px"}},Fe={style:{"text-align":"center","margin-top":"10px"}},Pe={__name:"CreateSubAccount",props:{clients:Array},emits:["create"],setup(_,{emit:$}){const c=P({username:"",email:"",password:""}),k=g(),I=g(!1),u=(v,n)=>I.value=n,p={username:[{required:!0,message:"请输入用户名",trigger:["blur","change"]},{validator:(v,n,m)=>{n===""?m(new Error("请输入用户名")):/^[a-zA-Z0-9\u4e00-\u9fa5]+$/.test(n)?m():m(new Error("用户名不能包含特殊字符，只能是中文/英文"))},trigger:["blur","change"]},{min:2,max:8,message:"用户名的长度必须在2-8个字符之间",trigger:["blur","change"]}],password:[{required:!0,message:"请输入密码",trigger:["blur","change"]},{min:6,max:16,message:"密码的长度必须在6-16个字符之间",trigger:["blur","change"]}],email:[{required:!0,message:"请输入邮件地址",trigger:["blur","change"]},{type:"email",message:"请输入合法的电子邮件地址",trigger:["blur","change"]}]},r=[],q=(v,n)=>{if(v)r.push(n);else{const m=r.indexOf(n);r.splice(m,1)}};function B(){k.value.validate(v=>{if(r.length===0){b.warning("请至少选择一个服务器用于子账户进行管理");return}v&&D("/api/user/sub/create",{...c,clients:r},()=>{b.success("子账户创建成功！"),$("create")})})}return(v,n)=>{const m=X,C=Y,V=ee,S=se,z=Ee,x=Ve,F=le;return f(),y("div",$e,[s("div",ke,[s("div",null,[Ce,Se,e(m,{style:{margin:"10px 0"}})]),s("div",null,[e(S,{"label-position":"top",rules:p,model:c,onValidate:u,ref_key:"formRef",ref:k},{default:a(()=>[e(V,{label:"用户名",prop:"username"},{default:a(()=>[e(C,{type:"text",modelValue:c.username,"onUpdate:modelValue":n[0]||(n[0]=l=>c.username=l),"prefix-icon":i(ge),placeholder:"子账户用户名",maxlength:"16"},null,8,["modelValue","prefix-icon"])]),_:1}),e(V,{label:"电子邮件",prop:"email"},{default:a(()=>[e(C,{type:"email",modelValue:c.email,"onUpdate:modelValue":n[1]||(n[1]=l=>c.email=l),"prefix-icon":i(ve),placeholder:"子账户电子邮件",maxlength:"16"},null,8,["modelValue","prefix-icon"])]),_:1}),e(V,{label:"密码",prop:"password"},{default:a(()=>[e(C,{type:"password",modelValue:c.password,"onUpdate:modelValue":n[2]||(n[2]=l=>c.password=l),"prefix-icon":i(R),placeholder:"子账户密码",maxlength:"16"},null,8,["modelValue","prefix-icon"])]),_:1})]),_:1},8,["model"]),e(m,{style:{margin:"10px 0"}}),ze]),e(x,{style:{flex:"1"}},{default:a(()=>[(f(!0),y(ae,null,oe(_.clients,l=>(f(),y("div",Ae,[e(z,{onChange:t=>q(t,l.id)},null,8,["onChange"]),s("div",Ue,[s("div",Ie,[s("span",{class:G(`flag-icon flag-icon-${l.location}`)},null,2),s("span",qe,w(l.name),1)]),s("div",Ne,[d(" 操作系统: "),s("i",{style:ye({color:i(Z)(l.osName).color}),class:G(`fa-brands ${i(Z)(l.osName).icon}`)},null,6),d(" "+w(`${l.osName} ${l.osVersion}`),1)]),s("div",Re,[s("span",Be,"公网IP: "+w(l.ip),1)])])]))),256))]),_:1}),s("div",Fe,[e(F,{onClick:B,type:"success",disabled:!I.value,plain:""},{default:a(()=>[d("确认创建")]),_:1},8,["disabled"])])])])}}},De=te(Pe,[["__scopeId","data-v-aa2e36eb"]]);const T=_=>(ne("data-v-82801bb7"),_=_(),ie(),_),Le={style:{display:"flex",gap:"10px"}},Te={style:{flex:"50%"}},Me={class:"info-card"},We=T(()=>s("div",{class:"title"},[s("i",{class:"fa-solid fa-lock"}),d(" 修改密码")],-1)),je={style:{"text-align":"center"}},Oe={class:"info-card",style:{"margin-top":"10px"}},Ze=T(()=>s("div",{class:"title"},[s("i",{class:"fa-regular fa-envelope"}),d(" 电子邮件设置")],-1)),Ge={class:"info-card",style:{flex:"50%"}},He=T(()=>s("div",{class:"title"},[s("i",{class:"fa-solid fa-users"}),d(" 子用户管理")],-1)),Je={key:0,style:{"text-align":"center"}},Ke={class:"account-card"},Qe={style:{"margin-left":"15px","line-height":"18px",flex:"1"}},Xe={style:{"font-size":"13px",color:"grey","margin-left":"5px"}},Ye={style:{"font-size":"13px",color:"grey"}},es={key:1},ss={__name:"Security",setup(_){const $=xe(),c=g(),k=g(!1),I=(l,t)=>k.value=t,u=P({password:"",new_password:"",new_password_repeat:""}),M=(l,t,h)=>{t===""?h(new Error("请再次输入密码")):t!==u.new_password?h(new Error("两次输入的密码不一致")):h()},p=P({email:$.user.email,code:""}),r=g(0),q=g(!0),B=(l,t)=>{l==="email"&&(q.value=t)},v=()=>{r.value=60;let l;N(`/api/auth/ask-code?email=${p.email}&type=modify`,()=>{b.success(`验证码已发送到邮箱: ${p.email}，请注意查收`),l=setInterval(()=>{r.value--,r.value===0&&clearInterval(l)},1e3)},t=>{b.warning(t),r.value=0})};function n(){D("/api/user/modify-email",p,()=>{b.success("邮件修改成功"),K(()=>Q.push("/"))})}const m={password:[{required:!0,message:"请输入原来的密码",trigger:"blur"}],new_password:[{required:!0,message:"请输入新的密码",trigger:"blur"},{min:6,max:16,message:"密码的长度必须在6-16个字符之间",trigger:["blur"]}],new_password_repeat:[{required:!0,message:"请重复输入新的密码",trigger:"blur"},{validator:M,trigger:["blur","change"]}],email:[{required:!0,message:"请输入邮件地址",trigger:"blur"},{type:"email",message:"请输入合法的电子邮件地址",trigger:["blur","change"]}]};function C(){c.value.validate(l=>{l&&D("/api/user/change-password",u,()=>{b.success("密码修改成功，请重新登录!"),K(()=>Q.push("/"))})})}const V=g([]);$.isAdmin&&N("/api/monitor/simple-list",l=>{V.value=l,z()});const S=g([]),z=()=>N("/api/user/sub/list",l=>S.value=l),x=g(!1);function F(l){N(`/api/user/sub/delete?uid=${l}`,()=>{b.success("子账户删除成功"),z()})}return(l,t)=>{const h=X,A=Y,U=ee,E=le,W=se,j=_e,re=fe,de=me,O=ue,ce=pe;return f(),y("div",Le,[s("div",Te,[s("div",Me,[We,e(h,{style:{margin:"10px 0"}}),e(W,{onValidate:I,model:u,rules:m,ref_key:"formRef",ref:c,style:{margin:"20px"},"label-width":"100"},{default:a(()=>[e(U,{label:"当前密码",prop:"password"},{default:a(()=>[e(A,{type:"password",modelValue:u.password,"onUpdate:modelValue":t[0]||(t[0]=o=>u.password=o),"prefix-icon":i(R),placeholder:"当前密码",maxlength:"16"},null,8,["modelValue","prefix-icon"])]),_:1}),e(U,{label:"新密码",prop:"new_password"},{default:a(()=>[e(A,{type:"password",modelValue:u.new_password,"onUpdate:modelValue":t[1]||(t[1]=o=>u.new_password=o),"prefix-icon":i(R),placeholder:"新密码",maxlength:"16"},null,8,["modelValue","prefix-icon"])]),_:1}),e(U,{label:"重复新密码",prop:"new_password_repeat"},{default:a(()=>[e(A,{type:"password",modelValue:u.new_password_repeat,"onUpdate:modelValue":t[2]||(t[2]=o=>u.new_password_repeat=o),"prefix-icon":i(R),placeholder:"重复新密码",maxlength:"16"},null,8,["modelValue","prefix-icon"])]),_:1}),s("div",je,[e(E,{icon:i(he),onClick:C,type:"success",disabled:!k.value},{default:a(()=>[d("立即重置密码")]),_:1},8,["icon","disabled"])])]),_:1},8,["model"])]),s("div",Oe,[Ze,e(h,{style:{margin:"10px 0"}}),e(W,{model:p,"label-position":"top",rules:m,ref:"emailFormRef",onValidate:B,style:{margin:"0 10px 10px 10px"}},{default:a(()=>[e(U,{label:"电子邮件",prop:"email"},{default:a(()=>[e(A,{modelValue:p.email,"onUpdate:modelValue":t[3]||(t[3]=o=>p.email=o)},null,8,["modelValue"])]),_:1}),e(U,null,{default:a(()=>[e(re,{style:{width:"100%"},gutter:10},{default:a(()=>[e(j,{span:18},{default:a(()=>[e(A,{placeholder:"请获取验证码",modelValue:p.code,"onUpdate:modelValue":t[4]||(t[4]=o=>p.code=o)},null,8,["modelValue"])]),_:1}),e(j,{span:6},{default:a(()=>[e(E,{type:"success",onClick:v,style:{width:"100%"},disabled:!q.value||r.value>0},{default:a(()=>[d(w(r.value>0?"请稍后 "+r.value+" 秒":"获取验证码"),1)]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}),s("div",null,[e(E,{onClick:n,disabled:!p.email,icon:i(be),type:"success"},{default:a(()=>[d("保存电子邮件")]),_:1},8,["disabled","icon"])])]),_:1},8,["model"])])]),s("div",Ge,[He,e(h,{style:{margin:"10px 0"}}),S.value.length?(f(),y("div",Je,[(f(!0),y(ae,null,oe(S.value,o=>(f(),y("div",Ke,[e(de,{class:"avatar",size:30,src:"https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcpng.png"}),s("div",Qe,[s("div",null,[s("span",null,w(o.username),1),s("span",Xe," 管理 "+w(o.clientList.length)+" 个服务器 ",1)]),s("div",Ye,w(o.email),1)]),e(E,{type:"danger",icon:i(we),onClick:ls=>F(o.id),text:""},{default:a(()=>[d("删除子账户")]),_:2},1032,["icon","onClick"])]))),256)),e(E,{icon:i(J),type:"primary",onClick:t[5]||(t[5]=o=>x.value=!0),plain:""},{default:a(()=>[d("添加更多子用户")]),_:1},8,["icon"])])):(f(),y("div",es,[i($).isAdmin?(f(),H(O,{key:0,"image-size":100,description:"还没有任何子用户哦"},{default:a(()=>[e(E,{icon:i(J),type:"primary",plain:"",onClick:t[6]||(t[6]=o=>x.value=!0)},{default:a(()=>[d("添加子用户")]),_:1},8,["icon"])]),_:1})):(f(),H(O,{key:1,"image-size":100,description:"子账户只能由管理员账号进行操作"}))]))]),e(ce,{modelValue:x.value,"onUpdate:modelValue":t[8]||(t[8]=o=>x.value=o),size:"350","with-header":!1},{default:a(()=>[e(De,{clients:V.value,onCreate:t[7]||(t[7]=o=>{x.value=!1,z()})},null,8,["clients"])]),_:1},8,["modelValue"])])}}},_s=te(ss,[["__scopeId","data-v-82801bb7"]]);export{_s as default};
